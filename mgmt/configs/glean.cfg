[system]
license_file=$LICENSE_FILE device_id=0 # $DEVICE_ID

platform=nvidia
engine_serialize=$ENGINE_SERIALIZE
engine_workspace=3013524480
#3106762240
engine_file=$ENGINE_FILE
weight_file=$WEIGHT_FILE
log_file=$LOG_FILE

precision_mode=32

[model] name=glean
text_thres=0.7
framework=pytorch
input=XX,$BATCH_SIZE,32,32,3,u8

[default] type=conv2d kernel=3 stride=1 pad=1 group=1 weight_order=wa dilation=1 act=leaky,0.2
[default] type=dense weight_order=aw seq=1 act=linear

[default] type=conv2dw stride=1 pad=1 group=1 dilation=1
[default] type=deconv2dw stride=1 pad=1 group=1 dilation=1


########################################################################################################################
[const] dim=1,1,1 value=0.2 dtype=f32 output=C
[const] dim=1,1,1,1 value=1e-8 dtype=f32 output=EPS
[const] dim=1,1,1 value=1.4142135623730951 output=SCALE

# injected_noise
[w2t] tensor_shape=1,4,4 dtype=f32	output=IN0		
[w2t] tensor_shape=1,8,8, dtype=f32	output=IN1		
[w2t] tensor_shape=1,8,8 dtype=f32	output=IN2		
[w2t] tensor_shape=1,16,16 dtype=f32	output=IN3	
[w2t] tensor_shape=1,16,16 dtype=f32	output=IN4	
[w2t] tensor_shape=1,32,32 dtype=f32	output=IN5	
[w2t] tensor_shape=1,32,32 dtype=f32	output=IN6	
[w2t] tensor_shape=1,64,64 dtype=f32	output=IN7	
[w2t] tensor_shape=1,64,64 dtype=f32	output=IN8
[w2t] tensor_shape=1,128,128 dtype=f32	output=IN9
[w2t] tensor_shape=1,128,128 dtype=f32	output=IN10
[w2t] tensor_shape=1,256,256 dtype=f32	output=IN11
[w2t] tensor_shape=1,256,256 dtype=f32	output=IN12

##################### encoder #####################
[preproc] input=XX input_mode=hwc3_bgr8 resize_mode=none norm_mode=zp1ms mean_rgb=0.5,0.5,0.5 std_rgb=0.5,0.5,0.5 output=M_S

# conv_first
[conv2d] input=M_S channel=64 act=linear output=CONV_FIRST

# RRDB 0 -> 23번 반복
# encoder.rdb1
[conv2d] channel=32 output=RDB0_1_X1

[concat] input=CONV_FIRST,RDB0_1_X1 axis=0
[conv2d] channel=32 output=RDB0_1_X2

[concat] input=CONV_FIRST,RDB0_1_X1,RDB0_1_X2 axis=0
[conv2d] channel=32 output=RDB0_1_X3

[concat] input=CONV_FIRST,RDB0_1_X1,RDB0_1_X2,RDB0_1_X3 axis=0
[conv2d] channel=32 output=RDB0_1_X4

[concat] input=CONV_FIRST,RDB0_1_X1,RDB0_1_X2,RDB0_1_X3,RDB0_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB0_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,CONV_FIRST output=RDB0_1


# encoder.rdb2
[conv2d] channel=32 output=RDB0_2_X1

[concat] input=RDB0_1,RDB0_2_X1 axis=0
[conv2d] channel=32 output=RDB0_2_X2

[concat] input=RDB0_1,RDB0_2_X1,RDB0_2_X2 axis=0
[conv2d] channel=32 output=RDB0_2_X3

[concat] input=RDB0_1,RDB0_2_X1,RDB0_2_X2,RDB0_2_X3 axis=0
[conv2d] channel=32 output=RDB0_2_X4

[concat] input=RDB0_1,RDB0_2_X1,RDB0_2_X2,RDB0_2_X3,RDB0_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB0_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB0_1 output=RDB0_2


# encoder.rdb3
[conv2d] channel=32 output=RDB0_3_X1

[concat] input=RDB0_2,RDB0_3_X1 axis=0
[conv2d] channel=32 output=RDB0_3_X2

[concat] input=RDB0_2,RDB0_3_X1,RDB0_3_X2 axis=0
[conv2d] channel=32 output=RDB0_3_X3

[concat] input=RDB0_2,RDB0_3_X1,RDB0_3_X2,RDB0_3_X3 axis=0
[conv2d] channel=32 output=RDB0_3_X4

[concat] input=RDB0_2,RDB0_3_X1,RDB0_3_X2,RDB0_3_X3,RDB0_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB0_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB0_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,CONV_FIRST output=RDB0_3


########################################################################
# RRDB 1
# encoder.rdb1
[conv2d] channel=32 output=RDB1_1_X1

[concat] input=RDB0_3,RDB1_1_X1 axis=0
[conv2d] channel=32 output=RDB1_1_X2

[concat] input=RDB0_3,RDB1_1_X1,RDB1_1_X2 axis=0
[conv2d] channel=32 output=RDB1_1_X3

[concat] input=RDB0_3,RDB1_1_X1,RDB1_1_X2,RDB1_1_X3 axis=0
[conv2d] channel=32 output=RDB1_1_X4

[concat] input=RDB0_3,RDB1_1_X1,RDB1_1_X2,RDB1_1_X3,RDB1_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB1_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB0_3 output=RDB1_1


# encoder.rdb2
[conv2d] channel=32 output=RDB1_2_X1

[concat] input=RDB1_1,RDB1_2_X1 axis=0
[conv2d] channel=32 output=RDB1_2_X2

[concat] input=RDB1_1,RDB1_2_X1,RDB1_2_X2 axis=0
[conv2d] channel=32 output=RDB1_2_X3

[concat] input=RDB1_1,RDB1_2_X1,RDB1_2_X2,RDB1_2_X3 axis=0
[conv2d] channel=32 output=RDB1_2_X4

[concat] input=RDB1_1,RDB1_2_X1,RDB1_2_X2,RDB1_2_X3,RDB1_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB1_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB1_1 output=RDB1_2


# encoder.rdb3
[conv2d] channel=32 output=RDB1_3_X1

[concat] input=RDB1_2,RDB1_3_X1 axis=0
[conv2d] channel=32 output=RDB1_3_X2

[concat] input=RDB1_2,RDB1_3_X1,RDB1_3_X2 axis=0
[conv2d] channel=32 output=RDB1_3_X3

[concat] input=RDB1_2,RDB1_3_X1,RDB1_3_X2,RDB1_3_X3 axis=0
[conv2d] channel=32 output=RDB1_3_X4

[concat] input=RDB1_2,RDB1_3_X1,RDB1_3_X2,RDB1_3_X3,RDB1_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB1_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB1_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB0_3 output=RDB1_3


########################################################################
# RRDB 2
# encoder.rdb1
[conv2d] channel=32 output=RDB2_1_X1

[concat] input=RDB1_3,RDB2_1_X1 axis=0
[conv2d] channel=32 output=RDB2_1_X2

[concat] input=RDB1_3,RDB2_1_X1,RDB2_1_X2 axis=0
[conv2d] channel=32 output=RDB2_1_X3

[concat] input=RDB1_3,RDB2_1_X1,RDB2_1_X2,RDB2_1_X3 axis=0
[conv2d] channel=32 output=RDB2_1_X4

[concat] input=RDB1_3,RDB2_1_X1,RDB2_1_X2,RDB2_1_X3,RDB2_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB2_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB1_3 output=RDB2_1


# encoder.rdb2
[conv2d] channel=32 output=RDB2_2_X1

[concat] input=RDB2_1,RDB2_2_X1 axis=0
[conv2d] channel=32 output=RDB2_2_X2

[concat] input=RDB2_1,RDB2_2_X1,RDB2_2_X2 axis=0
[conv2d] channel=32 output=RDB2_2_X3

[concat] input=RDB2_1,RDB2_2_X1,RDB2_2_X2,RDB2_2_X3 axis=0
[conv2d] channel=32 output=RDB2_2_X4

[concat] input=RDB2_1,RDB2_2_X1,RDB2_2_X2,RDB2_2_X3,RDB2_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB2_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB2_1 output=RDB2_2


# encoder.rdb3
[conv2d] channel=32 output=RDB2_3_X1

[concat] input=RDB2_2,RDB2_3_X1 axis=0
[conv2d] channel=32 output=RDB2_3_X2

[concat] input=RDB2_2,RDB2_3_X1,RDB2_3_X2 axis=0
[conv2d] channel=32 output=RDB2_3_X3

[concat] input=RDB2_2,RDB2_3_X1,RDB2_3_X2,RDB2_3_X3 axis=0
[conv2d] channel=32 output=RDB2_3_X4

[concat] input=RDB2_2,RDB2_3_X1,RDB2_3_X2,RDB2_3_X3,RDB2_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB2_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB2_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB1_3 output=RDB2_3


########################################################################
# RRDB 3
# encoder.rdb1
[conv2d] channel=32 output=RDB3_1_X1

[concat] input=RDB2_3,RDB3_1_X1 axis=0
[conv2d] channel=32 output=RDB3_1_X2

[concat] input=RDB2_3,RDB3_1_X1,RDB3_1_X2 axis=0
[conv2d] channel=32 output=RDB3_1_X3

[concat] input=RDB2_3,RDB3_1_X1,RDB3_1_X2,RDB3_1_X3 axis=0
[conv2d] channel=32 output=RDB3_1_X4

[concat] input=RDB2_3,RDB3_1_X1,RDB3_1_X2,RDB3_1_X3,RDB3_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB3_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB2_3 output=RDB3_1


# encoder.rdb2
[conv2d] channel=32 output=RDB3_2_X1

[concat] input=RDB3_1,RDB3_2_X1 axis=0
[conv2d] channel=32 output=RDB3_2_X2

[concat] input=RDB3_1,RDB3_2_X1,RDB3_2_X2 axis=0
[conv2d] channel=32 output=RDB3_2_X3

[concat] input=RDB3_1,RDB3_2_X1,RDB3_2_X2,RDB3_2_X3 axis=0
[conv2d] channel=32 output=RDB3_2_X4

[concat] input=RDB3_1,RDB3_2_X1,RDB3_2_X2,RDB3_2_X3,RDB3_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB3_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB3_1 output=RDB3_2


# encoder.rdb3
[conv2d] channel=32 output=RDB3_3_X1

[concat] input=RDB3_2,RDB3_3_X1 axis=0
[conv2d] channel=32 output=RDB3_3_X2

[concat] input=RDB3_2,RDB3_3_X1,RDB3_3_X2 axis=0
[conv2d] channel=32 output=RDB3_3_X3

[concat] input=RDB3_2,RDB3_3_X1,RDB3_3_X2,RDB3_3_X3 axis=0
[conv2d] channel=32 output=RDB3_3_X4

[concat] input=RDB3_2,RDB3_3_X1,RDB3_3_X2,RDB3_3_X3,RDB3_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB3_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB3_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB2_3 output=RDB3_3


########################################################################
# RRDB 4
# encoder.rdb1
[conv2d] channel=32 output=RDB4_1_X1

[concat] input=RDB3_3,RDB4_1_X1 axis=0
[conv2d] channel=32 output=RDB4_1_X2

[concat] input=RDB3_3,RDB4_1_X1,RDB4_1_X2 axis=0
[conv2d] channel=32 output=RDB4_1_X3

[concat] input=RDB3_3,RDB4_1_X1,RDB4_1_X2,RDB4_1_X3 axis=0
[conv2d] channel=32 output=RDB4_1_X4

[concat] input=RDB3_3,RDB4_1_X1,RDB4_1_X2,RDB4_1_X3,RDB4_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB4_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB3_3 output=RDB4_1


# encoder.rdb2
[conv2d] channel=32 output=RDB4_2_X1

[concat] input=RDB4_1,RDB4_2_X1 axis=0
[conv2d] channel=32 output=RDB4_2_X2

[concat] input=RDB4_1,RDB4_2_X1,RDB4_2_X2 axis=0
[conv2d] channel=32 output=RDB4_2_X3

[concat] input=RDB4_1,RDB4_2_X1,RDB4_2_X2,RDB4_2_X3 axis=0
[conv2d] channel=32 output=RDB4_2_X4

[concat] input=RDB4_1,RDB4_2_X1,RDB4_2_X2,RDB4_2_X3,RDB4_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB4_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB4_1 output=RDB4_2


# encoder.rdb3
[conv2d] channel=32 output=RDB4_3_X1

[concat] input=RDB4_2,RDB4_3_X1 axis=0
[conv2d] channel=32 output=RDB4_3_X2

[concat] input=RDB4_2,RDB4_3_X1,RDB4_3_X2 axis=0
[conv2d] channel=32 output=RDB4_3_X3

[concat] input=RDB4_2,RDB4_3_X1,RDB4_3_X2,RDB4_3_X3 axis=0
[conv2d] channel=32 output=RDB4_3_X4

[concat] input=RDB4_2,RDB4_3_X1,RDB4_3_X2,RDB4_3_X3,RDB4_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB4_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB4_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB3_3 output=RDB4_3


########################################################################
# RRDB 5
# encoder.rdb1
[conv2d] channel=32 output=RDB5_1_X1

[concat] input=RDB4_3,RDB5_1_X1 axis=0
[conv2d] channel=32 output=RDB5_1_X2

[concat] input=RDB4_3,RDB5_1_X1,RDB5_1_X2 axis=0
[conv2d] channel=32 output=RDB5_1_X3

[concat] input=RDB4_3,RDB5_1_X1,RDB5_1_X2,RDB5_1_X3 axis=0
[conv2d] channel=32 output=RDB5_1_X4

[concat] input=RDB4_3,RDB5_1_X1,RDB5_1_X2,RDB5_1_X3,RDB5_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB5_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB4_3 output=RDB5_1


# encoder.rdb2
[conv2d] channel=32 output=RDB5_2_X1

[concat] input=RDB5_1,RDB5_2_X1 axis=0
[conv2d] channel=32 output=RDB5_2_X2

[concat] input=RDB5_1,RDB5_2_X1,RDB5_2_X2 axis=0
[conv2d] channel=32 output=RDB5_2_X3

[concat] input=RDB5_1,RDB5_2_X1,RDB5_2_X2,RDB5_2_X3 axis=0
[conv2d] channel=32 output=RDB5_2_X4

[concat] input=RDB5_1,RDB5_2_X1,RDB5_2_X2,RDB5_2_X3,RDB5_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB5_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB5_1 output=RDB5_2


# encoder.rdb3
[conv2d] channel=32 output=RDB5_3_X1

[concat] input=RDB5_2,RDB5_3_X1 axis=0
[conv2d] channel=32 output=RDB5_3_X2

[concat] input=RDB5_2,RDB5_3_X1,RDB5_3_X2 axis=0
[conv2d] channel=32 output=RDB5_3_X3

[concat] input=RDB5_2,RDB5_3_X1,RDB5_3_X2,RDB5_3_X3 axis=0
[conv2d] channel=32 output=RDB5_3_X4

[concat] input=RDB5_2,RDB5_3_X1,RDB5_3_X2,RDB5_3_X3,RDB5_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB5_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB5_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB4_3 output=RDB5_3


########################################################################
# RRDB 6
# encoder.rdb1
[conv2d] channel=32 output=RDB6_1_X1

[concat] input=RDB5_3,RDB6_1_X1 axis=0
[conv2d] channel=32 output=RDB6_1_X2

[concat] input=RDB5_3,RDB6_1_X1,RDB6_1_X2 axis=0
[conv2d] channel=32 output=RDB6_1_X3

[concat] input=RDB5_3,RDB6_1_X1,RDB6_1_X2,RDB6_1_X3 axis=0
[conv2d] channel=32 output=RDB6_1_X4

[concat] input=RDB5_3,RDB6_1_X1,RDB6_1_X2,RDB6_1_X3,RDB6_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB6_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB5_3 output=RDB6_1


# encoder.rdb2
[conv2d] channel=32 output=RDB6_2_X1

[concat] input=RDB6_1,RDB6_2_X1 axis=0
[conv2d] channel=32 output=RDB6_2_X2

[concat] input=RDB6_1,RDB6_2_X1,RDB6_2_X2 axis=0
[conv2d] channel=32 output=RDB6_2_X3

[concat] input=RDB6_1,RDB6_2_X1,RDB6_2_X2,RDB6_2_X3 axis=0
[conv2d] channel=32 output=RDB6_2_X4

[concat] input=RDB6_1,RDB6_2_X1,RDB6_2_X2,RDB6_2_X3,RDB6_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB6_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB6_1 output=RDB6_2


# encoder.rdb3
[conv2d] channel=32 output=RDB6_3_X1

[concat] input=RDB6_2,RDB6_3_X1 axis=0
[conv2d] channel=32 output=RDB6_3_X2

[concat] input=RDB6_2,RDB6_3_X1,RDB6_3_X2 axis=0
[conv2d] channel=32 output=RDB6_3_X3

[concat] input=RDB6_2,RDB6_3_X1,RDB6_3_X2,RDB6_3_X3 axis=0
[conv2d] channel=32 output=RDB6_3_X4

[concat] input=RDB6_2,RDB6_3_X1,RDB6_3_X2,RDB6_3_X3,RDB6_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB6_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB6_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB5_3 output=RDB6_3


########################################################################
# RRDB 7
# encoder.rdb1
[conv2d] channel=32 output=RDB7_1_X1

[concat] input=RDB6_3,RDB7_1_X1 axis=0
[conv2d] channel=32 output=RDB7_1_X2

[concat] input=RDB6_3,RDB7_1_X1,RDB7_1_X2 axis=0
[conv2d] channel=32 output=RDB7_1_X3

[concat] input=RDB6_3,RDB7_1_X1,RDB7_1_X2,RDB7_1_X3 axis=0
[conv2d] channel=32 output=RDB7_1_X4

[concat] input=RDB6_3,RDB7_1_X1,RDB7_1_X2,RDB7_1_X3,RDB7_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB7_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB6_3 output=RDB7_1


# encoder.rdb2
[conv2d] channel=32 output=RDB7_2_X1

[concat] input=RDB7_1,RDB7_2_X1 axis=0
[conv2d] channel=32 output=RDB7_2_X2

[concat] input=RDB7_1,RDB7_2_X1,RDB7_2_X2 axis=0
[conv2d] channel=32 output=RDB7_2_X3

[concat] input=RDB7_1,RDB7_2_X1,RDB7_2_X2,RDB7_2_X3 axis=0
[conv2d] channel=32 output=RDB7_2_X4

[concat] input=RDB7_1,RDB7_2_X1,RDB7_2_X2,RDB7_2_X3,RDB7_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB7_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB7_1 output=RDB7_2


# encoder.rdb3
[conv2d] channel=32 output=RDB7_3_X1

[concat] input=RDB7_2,RDB7_3_X1 axis=0
[conv2d] channel=32 output=RDB7_3_X2

[concat] input=RDB7_2,RDB7_3_X1,RDB7_3_X2 axis=0
[conv2d] channel=32 output=RDB7_3_X3

[concat] input=RDB7_2,RDB7_3_X1,RDB7_3_X2,RDB7_3_X3 axis=0
[conv2d] channel=32 output=RDB7_3_X4

[concat] input=RDB7_2,RDB7_3_X1,RDB7_3_X2,RDB7_3_X3,RDB7_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB7_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB7_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB6_3 output=RDB7_3


########################################################################
# RRDB 8
# encoder.rdb1
[conv2d] channel=32 output=RDB8_1_X1

[concat] input=RDB7_3,RDB8_1_X1 axis=0
[conv2d] channel=32 output=RDB8_1_X2

[concat] input=RDB7_3,RDB8_1_X1,RDB8_1_X2 axis=0
[conv2d] channel=32 output=RDB8_1_X3

[concat] input=RDB7_3,RDB8_1_X1,RDB8_1_X2,RDB8_1_X3 axis=0
[conv2d] channel=32 output=RDB8_1_X4

[concat] input=RDB7_3,RDB8_1_X1,RDB8_1_X2,RDB8_1_X3,RDB8_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB8_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB7_3 output=RDB8_1


# encoder.rdb2
[conv2d] channel=32 output=RDB8_2_X1

[concat] input=RDB8_1,RDB8_2_X1 axis=0
[conv2d] channel=32 output=RDB8_2_X2

[concat] input=RDB8_1,RDB8_2_X1,RDB8_2_X2 axis=0
[conv2d] channel=32 output=RDB8_2_X3

[concat] input=RDB8_1,RDB8_2_X1,RDB8_2_X2,RDB8_2_X3 axis=0
[conv2d] channel=32 output=RDB8_2_X4

[concat] input=RDB8_1,RDB8_2_X1,RDB8_2_X2,RDB8_2_X3,RDB8_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB8_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB8_1 output=RDB8_2


# encoder.rdb3
[conv2d] channel=32 output=RDB8_3_X1

[concat] input=RDB8_2,RDB8_3_X1 axis=0
[conv2d] channel=32 output=RDB8_3_X2

[concat] input=RDB8_2,RDB8_3_X1,RDB8_3_X2 axis=0
[conv2d] channel=32 output=RDB8_3_X3

[concat] input=RDB8_2,RDB8_3_X1,RDB8_3_X2,RDB8_3_X3 axis=0
[conv2d] channel=32 output=RDB8_3_X4

[concat] input=RDB8_2,RDB8_3_X1,RDB8_3_X2,RDB8_3_X3,RDB8_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB8_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB8_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB7_3 output=RDB8_3


########################################################################
# RRDB 9
# encoder.rdb1
[conv2d] channel=32 output=RDB9_1_X1

[concat] input=RDB8_3,RDB9_1_X1 axis=0
[conv2d] channel=32 output=RDB9_1_X2

[concat] input=RDB8_3,RDB9_1_X1,RDB9_1_X2 axis=0
[conv2d] channel=32 output=RDB9_1_X3

[concat] input=RDB8_3,RDB9_1_X1,RDB9_1_X2,RDB9_1_X3 axis=0
[conv2d] channel=32 output=RDB9_1_X4

[concat] input=RDB8_3,RDB9_1_X1,RDB9_1_X2,RDB9_1_X3,RDB9_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB9_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB8_3 output=RDB9_1


# encoder.rdb2
[conv2d] channel=32 output=RDB9_2_X1

[concat] input=RDB9_1,RDB9_2_X1 axis=0
[conv2d] channel=32 output=RDB9_2_X2

[concat] input=RDB9_1,RDB9_2_X1,RDB9_2_X2 axis=0
[conv2d] channel=32 output=RDB9_2_X3

[concat] input=RDB9_1,RDB9_2_X1,RDB9_2_X2,RDB9_2_X3 axis=0
[conv2d] channel=32 output=RDB9_2_X4

[concat] input=RDB9_1,RDB9_2_X1,RDB9_2_X2,RDB9_2_X3,RDB9_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB9_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB9_1 output=RDB9_2


# encoder.rdb3
[conv2d] channel=32 output=RDB9_3_X1

[concat] input=RDB9_2,RDB9_3_X1 axis=0
[conv2d] channel=32 output=RDB9_3_X2

[concat] input=RDB9_2,RDB9_3_X1,RDB9_3_X2 axis=0
[conv2d] channel=32 output=RDB9_3_X3

[concat] input=RDB9_2,RDB9_3_X1,RDB9_3_X2,RDB9_3_X3 axis=0
[conv2d] channel=32 output=RDB9_3_X4

[concat] input=RDB9_2,RDB9_3_X1,RDB9_3_X2,RDB9_3_X3,RDB9_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB9_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB9_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB8_3 output=RDB9_3


########################################################################
# RRDB 10
# encoder.rdb1
[conv2d] channel=32 output=RDB10_1_X1

[concat] input=RDB9_3,RDB10_1_X1 axis=0
[conv2d] channel=32 output=RDB10_1_X2

[concat] input=RDB9_3,RDB10_1_X1,RDB10_1_X2 axis=0
[conv2d] channel=32 output=RDB10_1_X3

[concat] input=RDB9_3,RDB10_1_X1,RDB10_1_X2,RDB10_1_X3 axis=0
[conv2d] channel=32 output=RDB10_1_X4

[concat] input=RDB9_3,RDB10_1_X1,RDB10_1_X2,RDB10_1_X3,RDB10_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB10_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB9_3 output=RDB10_1


# encoder.rdb2
[conv2d] channel=32 output=RDB10_2_X1

[concat] input=RDB10_1,RDB10_2_X1 axis=0
[conv2d] channel=32 output=RDB10_2_X2

[concat] input=RDB10_1,RDB10_2_X1,RDB10_2_X2 axis=0
[conv2d] channel=32 output=RDB10_2_X3

[concat] input=RDB10_1,RDB10_2_X1,RDB10_2_X2,RDB10_2_X3 axis=0
[conv2d] channel=32 output=RDB10_2_X4

[concat] input=RDB10_1,RDB10_2_X1,RDB10_2_X2,RDB10_2_X3,RDB10_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB10_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB10_1 output=RDB10_2


# encoder.rdb3
[conv2d] channel=32 output=RDB10_3_X1

[concat] input=RDB10_2,RDB10_3_X1 axis=0
[conv2d] channel=32 output=RDB10_3_X2

[concat] input=RDB10_2,RDB10_3_X1,RDB10_3_X2 axis=0
[conv2d] channel=32 output=RDB10_3_X3

[concat] input=RDB10_2,RDB10_3_X1,RDB10_3_X2,RDB10_3_X3 axis=0
[conv2d] channel=32 output=RDB10_3_X4

[concat] input=RDB10_2,RDB10_3_X1,RDB10_3_X2,RDB10_3_X3,RDB10_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB10_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB10_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB9_3 output=RDB10_3


########################################################################
# RRDB 11
# encoder.rdb1
[conv2d] channel=32 output=RDB11_1_X1

[concat] input=RDB10_3,RDB11_1_X1 axis=0
[conv2d] channel=32 output=RDB11_1_X2

[concat] input=RDB10_3,RDB11_1_X1,RDB11_1_X2 axis=0
[conv2d] channel=32 output=RDB11_1_X3

[concat] input=RDB10_3,RDB11_1_X1,RDB11_1_X2,RDB11_1_X3 axis=0
[conv2d] channel=32 output=RDB11_1_X4

[concat] input=RDB10_3,RDB11_1_X1,RDB11_1_X2,RDB11_1_X3,RDB11_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB11_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB10_3 output=RDB11_1


# encoder.rdb2
[conv2d] channel=32 output=RDB11_2_X1

[concat] input=RDB11_1,RDB11_2_X1 axis=0
[conv2d] channel=32 output=RDB11_2_X2

[concat] input=RDB11_1,RDB11_2_X1,RDB11_2_X2 axis=0
[conv2d] channel=32 output=RDB11_2_X3

[concat] input=RDB11_1,RDB11_2_X1,RDB11_2_X2,RDB11_2_X3 axis=0
[conv2d] channel=32 output=RDB11_2_X4

[concat] input=RDB11_1,RDB11_2_X1,RDB11_2_X2,RDB11_2_X3,RDB11_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB11_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB11_1 output=RDB11_2


# encoder.rdb3
[conv2d] channel=32 output=RDB11_3_X1

[concat] input=RDB11_2,RDB11_3_X1 axis=0
[conv2d] channel=32 output=RDB11_3_X2

[concat] input=RDB11_2,RDB11_3_X1,RDB11_3_X2 axis=0
[conv2d] channel=32 output=RDB11_3_X3

[concat] input=RDB11_2,RDB11_3_X1,RDB11_3_X2,RDB11_3_X3 axis=0
[conv2d] channel=32 output=RDB11_3_X4

[concat] input=RDB11_2,RDB11_3_X1,RDB11_3_X2,RDB11_3_X3,RDB11_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB11_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB11_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB10_3 output=RDB11_3


########################################################################
# RRDB 12
# encoder.rdb1
[conv2d] channel=32 output=RDB12_1_X1

[concat] input=RDB11_3,RDB12_1_X1 axis=0
[conv2d] channel=32 output=RDB12_1_X2

[concat] input=RDB11_3,RDB12_1_X1,RDB12_1_X2 axis=0
[conv2d] channel=32 output=RDB12_1_X3

[concat] input=RDB11_3,RDB12_1_X1,RDB12_1_X2,RDB12_1_X3 axis=0
[conv2d] channel=32 output=RDB12_1_X4

[concat] input=RDB11_3,RDB12_1_X1,RDB12_1_X2,RDB12_1_X3,RDB12_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB12_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB11_3 output=RDB12_1


# encoder.rdb2
[conv2d] channel=32 output=RDB12_2_X1

[concat] input=RDB12_1,RDB12_2_X1 axis=0
[conv2d] channel=32 output=RDB12_2_X2

[concat] input=RDB12_1,RDB12_2_X1,RDB12_2_X2 axis=0
[conv2d] channel=32 output=RDB12_2_X3

[concat] input=RDB12_1,RDB12_2_X1,RDB12_2_X2,RDB12_2_X3 axis=0
[conv2d] channel=32 output=RDB12_2_X4

[concat] input=RDB12_1,RDB12_2_X1,RDB12_2_X2,RDB12_2_X3,RDB12_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB12_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB12_1 output=RDB12_2


# encoder.rdb3
[conv2d] channel=32 output=RDB12_3_X1

[concat] input=RDB12_2,RDB12_3_X1 axis=0
[conv2d] channel=32 output=RDB12_3_X2

[concat] input=RDB12_2,RDB12_3_X1,RDB12_3_X2 axis=0
[conv2d] channel=32 output=RDB12_3_X3

[concat] input=RDB12_2,RDB12_3_X1,RDB12_3_X2,RDB12_3_X3 axis=0
[conv2d] channel=32 output=RDB12_3_X4

[concat] input=RDB12_2,RDB12_3_X1,RDB12_3_X2,RDB12_3_X3,RDB12_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB12_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB12_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB11_3 output=RDB12_3


########################################################################
# RRDB 13
# encoder.rdb1
[conv2d] channel=32 output=RDB13_1_X1

[concat] input=RDB12_3,RDB13_1_X1 axis=0
[conv2d] channel=32 output=RDB13_1_X2

[concat] input=RDB12_3,RDB13_1_X1,RDB13_1_X2 axis=0
[conv2d] channel=32 output=RDB13_1_X3

[concat] input=RDB12_3,RDB13_1_X1,RDB13_1_X2,RDB13_1_X3 axis=0
[conv2d] channel=32 output=RDB13_1_X4

[concat] input=RDB12_3,RDB13_1_X1,RDB13_1_X2,RDB13_1_X3,RDB13_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB13_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB12_3 output=RDB13_1


# encoder.rdb2
[conv2d] channel=32 output=RDB13_2_X1

[concat] input=RDB13_1,RDB13_2_X1 axis=0
[conv2d] channel=32 output=RDB13_2_X2

[concat] input=RDB13_1,RDB13_2_X1,RDB13_2_X2 axis=0
[conv2d] channel=32 output=RDB13_2_X3

[concat] input=RDB13_1,RDB13_2_X1,RDB13_2_X2,RDB13_2_X3 axis=0
[conv2d] channel=32 output=RDB13_2_X4

[concat] input=RDB13_1,RDB13_2_X1,RDB13_2_X2,RDB13_2_X3,RDB13_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB13_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB13_1 output=RDB13_2


# encoder.rdb3
[conv2d] channel=32 output=RDB13_3_X1

[concat] input=RDB13_2,RDB13_3_X1 axis=0
[conv2d] channel=32 output=RDB13_3_X2

[concat] input=RDB13_2,RDB13_3_X1,RDB13_3_X2 axis=0
[conv2d] channel=32 output=RDB13_3_X3

[concat] input=RDB13_2,RDB13_3_X1,RDB13_3_X2,RDB13_3_X3 axis=0
[conv2d] channel=32 output=RDB13_3_X4

[concat] input=RDB13_2,RDB13_3_X1,RDB13_3_X2,RDB13_3_X3,RDB13_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB13_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB13_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB12_3 output=RDB13_3


########################################################################
# RRDB 14
# encoder.rdb1
[conv2d] channel=32 output=RDB14_1_X1

[concat] input=RDB13_3,RDB14_1_X1 axis=0
[conv2d] channel=32 output=RDB14_1_X2

[concat] input=RDB13_3,RDB14_1_X1,RDB14_1_X2 axis=0
[conv2d] channel=32 output=RDB14_1_X3

[concat] input=RDB13_3,RDB14_1_X1,RDB14_1_X2,RDB14_1_X3 axis=0
[conv2d] channel=32 output=RDB14_1_X4

[concat] input=RDB13_3,RDB14_1_X1,RDB14_1_X2,RDB14_1_X3,RDB14_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB14_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB13_3 output=RDB14_1


# encoder.rdb2
[conv2d] channel=32 output=RDB14_2_X1

[concat] input=RDB14_1,RDB14_2_X1 axis=0
[conv2d] channel=32 output=RDB14_2_X2

[concat] input=RDB14_1,RDB14_2_X1,RDB14_2_X2 axis=0
[conv2d] channel=32 output=RDB14_2_X3

[concat] input=RDB14_1,RDB14_2_X1,RDB14_2_X2,RDB14_2_X3 axis=0
[conv2d] channel=32 output=RDB14_2_X4

[concat] input=RDB14_1,RDB14_2_X1,RDB14_2_X2,RDB14_2_X3,RDB14_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB14_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB14_1 output=RDB14_2


# encoder.rdb3
[conv2d] channel=32 output=RDB14_3_X1

[concat] input=RDB14_2,RDB14_3_X1 axis=0
[conv2d] channel=32 output=RDB14_3_X2

[concat] input=RDB14_2,RDB14_3_X1,RDB14_3_X2 axis=0
[conv2d] channel=32 output=RDB14_3_X3

[concat] input=RDB14_2,RDB14_3_X1,RDB14_3_X2,RDB14_3_X3 axis=0
[conv2d] channel=32 output=RDB14_3_X4

[concat] input=RDB14_2,RDB14_3_X1,RDB14_3_X2,RDB14_3_X3,RDB14_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB14_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB14_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB13_3 output=RDB14_3


########################################################################
# RRDB 15
# encoder.rdb1
[conv2d] channel=32 output=RDB15_1_X1

[concat] input=RDB14_3,RDB15_1_X1 axis=0
[conv2d] channel=32 output=RDB15_1_X2

[concat] input=RDB14_3,RDB15_1_X1,RDB15_1_X2 axis=0
[conv2d] channel=32 output=RDB15_1_X3

[concat] input=RDB14_3,RDB15_1_X1,RDB15_1_X2,RDB15_1_X3 axis=0
[conv2d] channel=32 output=RDB15_1_X4

[concat] input=RDB14_3,RDB15_1_X1,RDB15_1_X2,RDB15_1_X3,RDB15_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB15_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB14_3 output=RDB15_1


# encoder.rdb2
[conv2d] channel=32 output=RDB15_2_X1

[concat] input=RDB15_1,RDB15_2_X1 axis=0
[conv2d] channel=32 output=RDB15_2_X2

[concat] input=RDB15_1,RDB15_2_X1,RDB15_2_X2 axis=0
[conv2d] channel=32 output=RDB15_2_X3

[concat] input=RDB15_1,RDB15_2_X1,RDB15_2_X2,RDB15_2_X3 axis=0
[conv2d] channel=32 output=RDB15_2_X4

[concat] input=RDB15_1,RDB15_2_X1,RDB15_2_X2,RDB15_2_X3,RDB15_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB15_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB15_1 output=RDB15_2


# encoder.rdb3
[conv2d] channel=32 output=RDB15_3_X1

[concat] input=RDB15_2,RDB15_3_X1 axis=0
[conv2d] channel=32 output=RDB15_3_X2

[concat] input=RDB15_2,RDB15_3_X1,RDB15_3_X2 axis=0
[conv2d] channel=32 output=RDB15_3_X3

[concat] input=RDB15_2,RDB15_3_X1,RDB15_3_X2,RDB15_3_X3 axis=0
[conv2d] channel=32 output=RDB15_3_X4

[concat] input=RDB15_2,RDB15_3_X1,RDB15_3_X2,RDB15_3_X3,RDB15_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB15_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB15_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB14_3 output=RDB15_3


########################################################################
# RRDB 16
# encoder.rdb1
[conv2d] channel=32 output=RDB16_1_X1

[concat] input=RDB15_3,RDB16_1_X1 axis=0
[conv2d] channel=32 output=RDB16_1_X2

[concat] input=RDB15_3,RDB16_1_X1,RDB16_1_X2 axis=0
[conv2d] channel=32 output=RDB16_1_X3

[concat] input=RDB15_3,RDB16_1_X1,RDB16_1_X2,RDB16_1_X3 axis=0
[conv2d] channel=32 output=RDB16_1_X4

[concat] input=RDB15_3,RDB16_1_X1,RDB16_1_X2,RDB16_1_X3,RDB16_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB16_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB15_3 output=RDB16_1


# encoder.rdb2
[conv2d] channel=32 output=RDB16_2_X1

[concat] input=RDB16_1,RDB16_2_X1 axis=0
[conv2d] channel=32 output=RDB16_2_X2

[concat] input=RDB16_1,RDB16_2_X1,RDB16_2_X2 axis=0
[conv2d] channel=32 output=RDB16_2_X3

[concat] input=RDB16_1,RDB16_2_X1,RDB16_2_X2,RDB16_2_X3 axis=0
[conv2d] channel=32 output=RDB16_2_X4

[concat] input=RDB16_1,RDB16_2_X1,RDB16_2_X2,RDB16_2_X3,RDB16_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB16_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB16_1 output=RDB16_2


# encoder.rdb3
[conv2d] channel=32 output=RDB16_3_X1

[concat] input=RDB16_2,RDB16_3_X1 axis=0
[conv2d] channel=32 output=RDB16_3_X2

[concat] input=RDB16_2,RDB16_3_X1,RDB16_3_X2 axis=0
[conv2d] channel=32 output=RDB16_3_X3

[concat] input=RDB16_2,RDB16_3_X1,RDB16_3_X2,RDB16_3_X3 axis=0
[conv2d] channel=32 output=RDB16_3_X4

[concat] input=RDB16_2,RDB16_3_X1,RDB16_3_X2,RDB16_3_X3,RDB16_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB16_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB16_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB15_3 output=RDB16_3


########################################################################
# RRDB 17
# encoder.rdb1
[conv2d] channel=32 output=RDB17_1_X1

[concat] input=RDB16_3,RDB17_1_X1 axis=0
[conv2d] channel=32 output=RDB17_1_X2

[concat] input=RDB16_3,RDB17_1_X1,RDB17_1_X2 axis=0
[conv2d] channel=32 output=RDB17_1_X3

[concat] input=RDB16_3,RDB17_1_X1,RDB17_1_X2,RDB17_1_X3 axis=0
[conv2d] channel=32 output=RDB17_1_X4

[concat] input=RDB16_3,RDB17_1_X1,RDB17_1_X2,RDB17_1_X3,RDB17_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB17_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB16_3 output=RDB17_1


# encoder.rdb2
[conv2d] channel=32 output=RDB17_2_X1

[concat] input=RDB17_1,RDB17_2_X1 axis=0
[conv2d] channel=32 output=RDB17_2_X2

[concat] input=RDB17_1,RDB17_2_X1,RDB17_2_X2 axis=0
[conv2d] channel=32 output=RDB17_2_X3

[concat] input=RDB17_1,RDB17_2_X1,RDB17_2_X2,RDB17_2_X3 axis=0
[conv2d] channel=32 output=RDB17_2_X4

[concat] input=RDB17_1,RDB17_2_X1,RDB17_2_X2,RDB17_2_X3,RDB17_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB17_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB17_1 output=RDB17_2


# encoder.rdb3
[conv2d] channel=32 output=RDB17_3_X1

[concat] input=RDB17_2,RDB17_3_X1 axis=0
[conv2d] channel=32 output=RDB17_3_X2

[concat] input=RDB17_2,RDB17_3_X1,RDB17_3_X2 axis=0
[conv2d] channel=32 output=RDB17_3_X3

[concat] input=RDB17_2,RDB17_3_X1,RDB17_3_X2,RDB17_3_X3 axis=0
[conv2d] channel=32 output=RDB17_3_X4

[concat] input=RDB17_2,RDB17_3_X1,RDB17_3_X2,RDB17_3_X3,RDB17_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB17_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB17_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB16_3 output=RDB17_3


########################################################################
# RRDB 18
# encoder.rdb1
[conv2d] channel=32 output=RDB18_1_X1

[concat] input=RDB17_3,RDB18_1_X1 axis=0
[conv2d] channel=32 output=RDB18_1_X2

[concat] input=RDB17_3,RDB18_1_X1,RDB18_1_X2 axis=0
[conv2d] channel=32 output=RDB18_1_X3

[concat] input=RDB17_3,RDB18_1_X1,RDB18_1_X2,RDB18_1_X3 axis=0
[conv2d] channel=32 output=RDB18_1_X4

[concat] input=RDB17_3,RDB18_1_X1,RDB18_1_X2,RDB18_1_X3,RDB18_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB18_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB17_3 output=RDB18_1


# encoder.rdb2
[conv2d] channel=32 output=RDB18_2_X1

[concat] input=RDB18_1,RDB18_2_X1 axis=0
[conv2d] channel=32 output=RDB18_2_X2

[concat] input=RDB18_1,RDB18_2_X1,RDB18_2_X2 axis=0
[conv2d] channel=32 output=RDB18_2_X3

[concat] input=RDB18_1,RDB18_2_X1,RDB18_2_X2,RDB18_2_X3 axis=0
[conv2d] channel=32 output=RDB18_2_X4

[concat] input=RDB18_1,RDB18_2_X1,RDB18_2_X2,RDB18_2_X3,RDB18_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB18_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB18_1 output=RDB18_2


# encoder.rdb3
[conv2d] channel=32 output=RDB18_3_X1

[concat] input=RDB18_2,RDB18_3_X1 axis=0
[conv2d] channel=32 output=RDB18_3_X2

[concat] input=RDB18_2,RDB18_3_X1,RDB18_3_X2 axis=0
[conv2d] channel=32 output=RDB18_3_X3

[concat] input=RDB18_2,RDB18_3_X1,RDB18_3_X2,RDB18_3_X3 axis=0
[conv2d] channel=32 output=RDB18_3_X4

[concat] input=RDB18_2,RDB18_3_X1,RDB18_3_X2,RDB18_3_X3,RDB18_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB18_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB18_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB17_3 output=RDB18_3


########################################################################
# RRDB 19
# encoder.rdb1
[conv2d] channel=32 output=RDB19_1_X1

[concat] input=RDB18_3,RDB19_1_X1 axis=0
[conv2d] channel=32 output=RDB19_1_X2

[concat] input=RDB18_3,RDB19_1_X1,RDB19_1_X2 axis=0
[conv2d] channel=32 output=RDB19_1_X3

[concat] input=RDB18_3,RDB19_1_X1,RDB19_1_X2,RDB19_1_X3 axis=0
[conv2d] channel=32 output=RDB19_1_X4

[concat] input=RDB18_3,RDB19_1_X1,RDB19_1_X2,RDB19_1_X3,RDB19_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB19_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB18_3 output=RDB19_1


# encoder.rdb2
[conv2d] channel=32 output=RDB19_2_X1

[concat] input=RDB19_1,RDB19_2_X1 axis=0
[conv2d] channel=32 output=RDB19_2_X2

[concat] input=RDB19_1,RDB19_2_X1,RDB19_2_X2 axis=0
[conv2d] channel=32 output=RDB19_2_X3

[concat] input=RDB19_1,RDB19_2_X1,RDB19_2_X2,RDB19_2_X3 axis=0
[conv2d] channel=32 output=RDB19_2_X4

[concat] input=RDB19_1,RDB19_2_X1,RDB19_2_X2,RDB19_2_X3,RDB19_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB19_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB19_1 output=RDB19_2


# encoder.rdb3
[conv2d] channel=32 output=RDB19_3_X1

[concat] input=RDB19_2,RDB19_3_X1 axis=0
[conv2d] channel=32 output=RDB19_3_X2

[concat] input=RDB19_2,RDB19_3_X1,RDB19_3_X2 axis=0
[conv2d] channel=32 output=RDB19_3_X3

[concat] input=RDB19_2,RDB19_3_X1,RDB19_3_X2,RDB19_3_X3 axis=0
[conv2d] channel=32 output=RDB19_3_X4

[concat] input=RDB19_2,RDB19_3_X1,RDB19_3_X2,RDB19_3_X3,RDB19_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB19_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB19_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB18_3 output=RDB19_3


########################################################################
# RRDB 20
# encoder.rdb1
[conv2d] channel=32 output=RDB20_1_X1

[concat] input=RDB19_3,RDB20_1_X1 axis=0
[conv2d] channel=32 output=RDB20_1_X2

[concat] input=RDB19_3,RDB20_1_X1,RDB20_1_X2 axis=0
[conv2d] channel=32 output=RDB20_1_X3

[concat] input=RDB19_3,RDB20_1_X1,RDB20_1_X2,RDB20_1_X3 axis=0
[conv2d] channel=32 output=RDB20_1_X4

[concat] input=RDB19_3,RDB20_1_X1,RDB20_1_X2,RDB20_1_X3,RDB20_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB20_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB19_3 output=RDB20_1


# encoder.rdb2
[conv2d] channel=32 output=RDB20_2_X1

[concat] input=RDB20_1,RDB20_2_X1 axis=0
[conv2d] channel=32 output=RDB20_2_X2

[concat] input=RDB20_1,RDB20_2_X1,RDB20_2_X2 axis=0
[conv2d] channel=32 output=RDB20_2_X3

[concat] input=RDB20_1,RDB20_2_X1,RDB20_2_X2,RDB20_2_X3 axis=0
[conv2d] channel=32 output=RDB20_2_X4

[concat] input=RDB20_1,RDB20_2_X1,RDB20_2_X2,RDB20_2_X3,RDB20_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB20_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB20_1 output=RDB20_2


# encoder.rdb3
[conv2d] channel=32 output=RDB20_3_X1

[concat] input=RDB20_2,RDB20_3_X1 axis=0
[conv2d] channel=32 output=RDB20_3_X2

[concat] input=RDB20_2,RDB20_3_X1,RDB20_3_X2 axis=0
[conv2d] channel=32 output=RDB20_3_X3

[concat] input=RDB20_2,RDB20_3_X1,RDB20_3_X2,RDB20_3_X3 axis=0
[conv2d] channel=32 output=RDB20_3_X4

[concat] input=RDB20_2,RDB20_3_X1,RDB20_3_X2,RDB20_3_X3,RDB20_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB20_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB20_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB19_3 output=RDB20_3


########################################################################
# RRDB 21
# encoder.rdb1
[conv2d] channel=32 output=RDB21_1_X1

[concat] input=RDB20_3,RDB21_1_X1 axis=0
[conv2d] channel=32 output=RDB21_1_X2

[concat] input=RDB20_3,RDB21_1_X1,RDB21_1_X2 axis=0
[conv2d] channel=32 output=RDB21_1_X3

[concat] input=RDB20_3,RDB21_1_X1,RDB21_1_X2,RDB21_1_X3 axis=0
[conv2d] channel=32 output=RDB21_1_X4

[concat] input=RDB20_3,RDB21_1_X1,RDB21_1_X2,RDB21_1_X3,RDB21_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB21_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB20_3 output=RDB21_1


# encoder.rdb2
[conv2d] channel=32 output=RDB21_2_X1

[concat] input=RDB21_1,RDB21_2_X1 axis=0
[conv2d] channel=32 output=RDB21_2_X2

[concat] input=RDB21_1,RDB21_2_X1,RDB21_2_X2 axis=0
[conv2d] channel=32 output=RDB21_2_X3

[concat] input=RDB21_1,RDB21_2_X1,RDB21_2_X2,RDB21_2_X3 axis=0
[conv2d] channel=32 output=RDB21_2_X4

[concat] input=RDB21_1,RDB21_2_X1,RDB21_2_X2,RDB21_2_X3,RDB21_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB21_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB21_1 output=RDB21_2


# encoder.rdb3
[conv2d] channel=32 output=RDB21_3_X1

[concat] input=RDB21_2,RDB21_3_X1 axis=0
[conv2d] channel=32 output=RDB21_3_X2

[concat] input=RDB21_2,RDB21_3_X1,RDB21_3_X2 axis=0
[conv2d] channel=32 output=RDB21_3_X3

[concat] input=RDB21_2,RDB21_3_X1,RDB21_3_X2,RDB21_3_X3 axis=0
[conv2d] channel=32 output=RDB21_3_X4

[concat] input=RDB21_2,RDB21_3_X1,RDB21_3_X2,RDB21_3_X3,RDB21_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB21_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB21_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB20_3 output=RDB21_3


########################################################################
# RRDB 22
# encoder.rdb1
[conv2d] channel=32 output=RDB22_1_X1

[concat] input=RDB21_3,RDB22_1_X1 axis=0
[conv2d] channel=32 output=RDB22_1_X2

[concat] input=RDB21_3,RDB22_1_X1,RDB22_1_X2 axis=0
[conv2d] channel=32 output=RDB22_1_X3

[concat] input=RDB21_3,RDB22_1_X1,RDB22_1_X2,RDB22_1_X3 axis=0
[conv2d] channel=32 output=RDB22_1_X4

[concat] input=RDB21_3,RDB22_1_X1,RDB22_1_X2,RDB22_1_X3,RDB22_1_X4 axis=0
[conv2d] channel=64 act=linear output=RDB22_1_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB21_3 output=RDB22_1


# encoder.rdb2
[conv2d] channel=32 output=RDB22_2_X1

[concat] input=RDB22_1,RDB22_2_X1 axis=0
[conv2d] channel=32 output=RDB22_2_X2

[concat] input=RDB22_1,RDB22_2_X1,RDB22_2_X2 axis=0
[conv2d] channel=32 output=RDB22_2_X3

[concat] input=RDB22_1,RDB22_2_X1,RDB22_2_X2,RDB22_2_X3 axis=0
[conv2d] channel=32 output=RDB22_2_X4

[concat] input=RDB22_1,RDB22_2_X1,RDB22_2_X2,RDB22_2_X3,RDB22_2_X4 axis=0
[conv2d] channel=64 act=linear output=RDB22_2_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB22_1 output=RDB22_2


# encoder.rdb3
[conv2d] channel=32 output=RDB22_3_X1

[concat] input=RDB22_2,RDB22_3_X1 axis=0
[conv2d] channel=32 output=RDB22_3_X2

[concat] input=RDB22_2,RDB22_3_X1,RDB22_3_X2 axis=0
[conv2d] channel=32 output=RDB22_3_X3

[concat] input=RDB22_2,RDB22_3_X1,RDB22_3_X2,RDB22_3_X3 axis=0
[conv2d] channel=32 output=RDB22_3_X4

[concat] input=RDB22_2,RDB22_3_X1,RDB22_3_X2,RDB22_3_X3,RDB22_3_X4 axis=0
[conv2d] channel=64 act=linear output=RDB22_3_X5
[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB22_2

[eltwise] mode=prod input=*,C
[eltwise] mode=sum input=*,RDB21_3 output=RDB22_3


# conv_body
[conv2d] input=RDB22_3 channel=64 act=linear
[eltwise] mode=sum input=*,CONV_FIRST
[conv2d] channel=512 output=E3

[conv2d] channel=512 stride=2
[conv2d] channel=512 output=E2

[conv2d] channel=512 stride=2
[conv2d] channel=512 output=E1

[conv2d] channel=512 stride=2
[conv2d] channel=512 output=E0

[conv2d] channel=512

[flatten]
[dense] unit=7168 weight_order=wa seq=0 act=linear			# torch.Size([1, 7168])
[reshape] shape=-1,512 output=LATENT

##################### generator #####################
# latent[1,14,512] -> split -> [1, 512] => style
[split] input=LATENT axis=0 start=0 end=1 output=L0			# latent[:, 0]
[split] input=LATENT axis=0 start=1 end=2 output=L1			# latent[:, 1]
[split] input=LATENT axis=0 start=2 end=3 output=L2			# latent[:, 2]
[split] input=LATENT axis=0 start=3 end=4 output=L3			# latent[:, 3]
[split] input=LATENT axis=0 start=4 end=5 output=L4			# latent[:, 4]
[split] input=LATENT axis=0 start=5 end=6 output=L5			# latent[:, 5]
[split] input=LATENT axis=0 start=6 end=7 output=L6			# latent[:, 3]
[split] input=LATENT axis=0 start=7 end=8 output=L7			# latent[:, 4]
[split] input=LATENT axis=0 start=8 end=9 output=L8			# latent[:, 5]
[split] input=LATENT axis=0 start=9 end=10 output=L9			# latent[:, 3]
[split] input=LATENT axis=0 start=10 end=11 output=L10			# latent[:, 4]
[split] input=LATENT axis=0 start=11 end=12 output=L11			# latent[:, 5]
[split] input=LATENT axis=0 start=12 end=13 output=L12			# latent[:, 5]
[split] input=LATENT axis=0 start=13 end=14 output=L13			# latent[:, 5]

##################### 4x4 stage #####################
[w2t] tensor_shape=512,4,4 output=CONSTANT			# constant_input
[w2t] tensor_shape=512,512,3,3 output=WO			# conv.weight_orig

### conv1
[dense] input=L0 unit=512									# conv1.style
[reshape] shape=1,-1,1,1
[eltwise] mode=mul input=WO,* output=W1				# weight * style

# demodulate
[eltwise] mode=mul input=*,*					# weight.pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1		# sum([2, 3, 4])
[eltwise] mode=sum input=*,EPS					
[unary] mode=rsqrt											# demod
[eltwise] mode=prod input=W1,*								# weight * demod
[conv2dw] input=CONSTANT,* channel=512 kernel=3 output=IMG	

[w2t] tensor_shape=1,1,1 output=N				# noise_injector.weight
[eltwise] mode=mul input=IN0,*
[eltwise] mode=add input=IMG,* output=O0

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1 output=AB			# activate.bias  
[eltwise] mode=sum input=O0,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=GC		# conv1 out

### to_rgb1
[w2t] tensor_shape=3,1,1 output=RB				# bias 
[w2t] tensor_shape=3,512,1,1 output=RW			# conv.weight_orig
[dense] input=L1 unit=512 						# to_rgb1.style
[reshape] shape=1,-1,1,1

[eltwise] mode=mul input=RW,* 

[conv2dw] input=GC,* channel=3 kernel=1 pad=0	
[eltwise] mode=sum input=*,RB output=SKIP		


##################### 8x8 stage #####################
# 0 
[concat] input=GC,E0 axis=0
[conv2d] channel=512 output=FO act=linear				# fusion_out 
[concat] input=SKIP,E0 axis=0 
[conv2d] channel=3 output=FS0 act=linear				# fusion_skip 

# up_conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=UW0				# weight
[dense] input=L1 unit=512 								# latent[:, 1] style_modulation = ( linear(x) + bias * lr_mul ) + style_bias  |  lr_mul = 1. , style_bias = 0.0
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=UW0,* output=UWS0						# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=UWS0,* 
[reshape] before_trans=1,0,2,3
[deconv2dw] input=FO,* channel=512 kernel=3 pad=0 stride=2 
[upfirdn2d] kernel=4 up=1 down=1 pad=1 output=UIMG0

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN1,*
[eltwise] mode=add input=UIMG0,* output=UNI0

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1						# activate.bias  
[eltwise] mode=sum input=UNI0,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=UC0		# up_conv out

# conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=CW0				#  weight
[dense] input=L2 unit=512 								# latent[:, 2] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=CW0,* output=CWS0						# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=CWS0,* 
[conv2dw] input=UC0,* channel=512 kernel=3 output=CIMG0

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN2,*
[eltwise] mode=add input=CIMG0,* output=CNI0

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1								# activate.bias  
[eltwise] mode=sum input=CNI0,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=C0				# conv out

# to_rgb -------------------------------- 
[w2t] tensor_shape=3,1,1 output=RB0								# bias  
[upfirdn2d] input=FS0 kernel=4 up=2 down=1 pad=2,1 output=RS0	# upsample(skip)

[w2t] tensor_shape=3,512,1,1 output=RW0					#  weight
[dense] input=L3 unit=512 								# latent[:, 3] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=RW0,* output=RWS0				# weight * style
[conv2dw] input=C0,* channel=3 kernel=1 pad=0

[eltwise] mode=add input=*,RB0 
[eltwise] mode=add input=*,RS0 output=R0				# skip 

########################################################################
# 1 
[concat] input=C0,E1 axis=0 
[conv2d] channel=512 output=F1 act=linear				# fusion_out 
[concat] input=R0,E1 axis=0 
[conv2d] channel=3 output=FS1 act=linear				# fusion_skip 

# up_conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=UW1				# weight
[dense] input=L3 unit=512 								# latent[:, 3] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=UW1,* output=UWS1				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=UWS1,* 
[reshape] before_trans=1,0,2,3
[deconv2dw] input=F1,* channel=512 kernel=3 pad=0 stride=2 
[upfirdn2d] kernel=4 up=1 down=1 pad=1 output=UIMG1

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN3,*
[eltwise] mode=add input=UIMG1,* output=UNI1 

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1						# activate.bias  
[eltwise] mode=sum input=UNI1,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=UC1		# up_conv out

# conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=CW1				#  weight
[dense] input=L4 unit=512 								# latent[:, 4] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=CW1,* output=CWS1				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=CWS1,* 
[conv2dw] input=UC1,* channel=512 kernel=3 output=CIMG1

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN4,*
[eltwise] mode=add input=CIMG1,* output=CNI1

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1								# activate.bias  
[eltwise] mode=sum input=CNI1,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=C1				# conv out # 여기까지 확인

# to_rgb -------------------------------- 
[w2t] tensor_shape=3,1,1 output=RB1								# bias  
[upfirdn2d] input=FS1 kernel=4 up=2 down=1 pad=2,1 output=RS1	# upsample(skip)

[w2t] tensor_shape=3,512,1,1 output=RW1					#  weight
[dense] input=L5 unit=512 								# latent[:, 5] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=RW1,* output=RWS1				# weight * style
[conv2dw] input=C1,* channel=3 kernel=1 pad=0

[eltwise] mode=add input=*,RB1 
[eltwise] mode=add input=*,RS1 output=R1				# skip 


########################################################################
# 2 
[concat] input=C1,E2 axis=0 
[conv2d] channel=512 output=F2 act=linear				# fusion_out 
[concat] input=R1,E2 axis=0 
[conv2d] channel=3 output=FS2 act=linear				# fusion_skip 

# up_conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=UW2				# weight
[dense] input=L5 unit=512 								# latent[:, 5] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=UW2,* output=UWS2				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=UWS2,* 
[reshape] before_trans=1,0,2,3
[deconv2dw] input=F2,* channel=512 kernel=3 pad=0 stride=2 
[upfirdn2d] kernel=4 up=1 down=1 pad=1 output=UIMG2

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN5,*
[eltwise] mode=add input=UIMG2,* output=UNI2 

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1						# activate.bias  
[eltwise] mode=sum input=UNI2,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=UC2		# up_conv out

# conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=CW2				#  weight
[dense] input=L6 unit=512 								# latent[:, 6] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=CW2,* output=CWS2				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=CWS2,* 
[conv2dw] input=UC2,* channel=512 kernel=3 output=CIMG2

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN6,*
[eltwise] mode=add input=CIMG2,* output=CNI2

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1								# activate.bias  
[eltwise] mode=sum input=CNI2,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=C2				# conv out 

# to_rgb -------------------------------- 
[w2t] tensor_shape=3,1,1 output=RB2								# bias  
[upfirdn2d] input=FS2 kernel=4 up=2 down=1 pad=2,1 output=RS2	# upsample(skip)

[w2t] tensor_shape=3,512,1,1 output=RW2					#  weight
[dense] input=L7 unit=512 								# latent[:, 7] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=RW2,* output=RWS2				# weight * style
[conv2dw] input=C2,* channel=3 kernel=1 pad=0

[eltwise] mode=add input=*,RB2 
[eltwise] mode=add input=*,RS2 output=R2				# skip 


########################################################################
# 3 
[concat] input=C2,E3 axis=0 
[conv2d] channel=512 output=F3 act=linear				# fusion_out 
[concat] input=R2,E3 axis=0 
[conv2d] channel=3 output=FS3 act=linear				# fusion_skip 

# up_conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=UW3				# weight
[dense] input=L7 unit=512 								# latent[:, 7] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=UW3,* output=UWS3				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=UWS3,* 
[reshape] before_trans=1,0,2,3
[deconv2dw] input=F3,* channel=512 kernel=3 pad=0 stride=2 
[upfirdn2d] kernel=4 up=1 down=1 pad=1 output=UIMG3

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN7,*
[eltwise] mode=add input=UIMG3,* output=UNI3 

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1						# activate.bias  
[eltwise] mode=sum input=UNI3,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=UC3		# up_conv out

# conv -------------------------------- 
[w2t] tensor_shape=512,512,3,3 output=CW3				#  weight
[dense] input=L8 unit=512 								# latent[:, 8] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=CW3,* output=CWS3				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=CWS3,* 
[conv2dw] input=UC3,* channel=512 kernel=3 output=CIMG3

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN8,*
[eltwise] mode=add input=CIMG3,* output=CNI3

# FusedLeakyRelu
[w2t] tensor_shape=512,1,1								# activate.bias  
[eltwise] mode=sum input=CNI3,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=C3				# conv out

# to_rgb -------------------------------- 
[w2t] tensor_shape=3,1,1 output=RB3								# bias  
[upfirdn2d] input=FS3 kernel=4 up=2 down=1 pad=2,1 output=RS3	# upsample(skip)

[w2t] tensor_shape=3,512,1,1 output=RW3					#  weight
[dense] input=L9 unit=512 								# latent[:, 9] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=RW3,* output=RWS3				# weight * style
[conv2dw] input=C3,* channel=3 kernel=1 pad=0

[eltwise] mode=add input=*,RB3 
[eltwise] mode=add input=*,RS3 output=R3				# skip 


########################################################################
# 4 
# up_conv -------------------------------- 
[w2t] tensor_shape=256,512,3,3 output=UW4				# weight
[dense] input=L9 unit=512 								# latent[:, 9] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=UW4,* output=UWS4				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=UWS4,* 
[reshape] before_trans=1,0,2,3
[deconv2dw] input=C3,* channel=256 kernel=3 pad=0 stride=2 
[upfirdn2d] kernel=4 up=1 down=1 pad=1 output=UIMG4

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN9,*
[eltwise] mode=add input=UIMG4,* output=UNI4 

# FusedLeakyRelu
[w2t] tensor_shape=256,1,1						# activate.bias  
[eltwise] mode=sum input=UNI4,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=UC4		# up_conv out

# conv -------------------------------- 
[w2t] tensor_shape=256,256,3,3 output=CW4				#  weight
[dense] input=L10 unit=256 								# latent[:, 10] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=CW4,* output=CWS4				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=CWS4,* 
[conv2dw] input=UC4,* channel=256 kernel=3 output=CIMG4

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN10,*
[eltwise] mode=add input=CIMG4,* output=CNI4

# FusedLeakyRelu
[w2t] tensor_shape=256,1,1								# activate.bias  
[eltwise] mode=sum input=CNI4,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=C4				# conv out 


# to_rgb -------------------------------- 
[w2t] tensor_shape=3,1,1 output=RB4								# bias  
[upfirdn2d] input=R3 kernel=4 up=2 down=1 pad=2,1 output=RS4	# upsample(skip)

[w2t] tensor_shape=3,256,1,1 output=RW4					#  weight
[dense] input=L11 unit=256 								# latent[:, 11] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=RW4,* output=RWS4				# weight * style
[conv2dw] input=C4,* channel=3 kernel=1 pad=0

[eltwise] mode=add input=*,RB4 
[eltwise] mode=add input=*,RS4 output=R4				# skip  


########################################################################
# 5
# up_conv -------------------------------- 
[w2t] tensor_shape=128,256,3,3 output=UW5				# weight
[dense] input=L11 unit=256 								# latent[:, 11] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=UW5,* output=UWS5				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=UWS5,* 
[reshape] before_trans=1,0,2,3
[deconv2dw] input=C4,* channel=128 kernel=3 pad=0 stride=2 
[upfirdn2d] kernel=4 up=1 down=1 pad=1 output=UIMG5

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN11,*
[eltwise] mode=add input=UIMG5,* output=UNI5 

# FusedLeakyRelu
[w2t] tensor_shape=128,1,1						# activate.bias  
[eltwise] mode=sum input=UNI5,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=UC5		# up_conv out

# conv -------------------------------- 
[w2t] tensor_shape=128,128,3,3 output=CW5				#  weight
[dense] input=L12 unit=128 								# latent[:, 12] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=CW5,* output=CWS5				# weight * style

# demodulate
[eltwise] mode=prod input=*,*							# pow(2)
[reduce] mode=sum axis=1,2,3 keep_dims=1
[eltwise] mode=add input=*,EPS
[unary] mode=rsqrt 										# demod
[eltwise] mode=prod input=CWS5,* 
[conv2dw] input=UC5,* channel=128 kernel=3 output=CIMG5

# noise_injector 
[w2t] tensor_shape=1,1,1								# noise_injector.weight
[eltwise] mode=mul input=IN12,*
[eltwise] mode=add input=CIMG5,* output=CNI5

# FusedLeakyRelu
[w2t] tensor_shape=128,1,1								# activate.bias  
[eltwise] mode=sum input=CNI5,* act=leaky,0.2
[eltwise] mode=mul input=*,SCALE output=C5				# conv out 


# to_rgb -------------------------------- 
[w2t] tensor_shape=3,1,1 output=RB5								# bias  
[upfirdn2d] input=R4 kernel=4 up=2 down=1 pad=2,1 output=RS5	# upsample(skip)

[w2t] tensor_shape=3,128,1,1 output=RW5					#  weight
[dense] input=L13 unit=128 								# latent[:, 13] style_modulation 
[reshape] shape=1,-1,1,1								# style
[eltwise] mode=mul input=RW5,* output=RWS5				# weight * style
[conv2dw] input=C5,* channel=3 kernel=1 pad=0

[eltwise] mode=add input=*,RB5 
[eltwise] mode=add input=*,RS5 output=R5				# skip 

##################### decoder #####################
## Block0
[conv2d] input=E3 channel=2048 act=linear
[pixelshuffle] upscale_factor=2 

## Block1
[concat] input=*,C3 axis=0 
[conv2d] channel=1024 act=linear
[pixelshuffle] upscale_factor=2

## Block2
[concat] input=*,C4 axis=0
[conv2d] channel=512 act=linear
[pixelshuffle] upscale_factor=2 

## Block3
[concat] input=*,C5 axis=0 
[conv2d] channel=64 
[conv2d] channel=3 act=linear output=HR						# Glean Generator output

##################### normalize #####################		# from [-1, 1] to [0, 1]
[const] dim=1,1,1 value=1 dtype=f32 output=ONE
[const] dim=1,1,1 value=2 dtype=f32 output=TWO	
[eltwise] mode=sum input=HR,ONE								# + 1.
[eltwise] mode=div input=*,TWO 								# / 2.

# [C, H, W] -> [H, W, C]
[reshape] before_trans=1,2,0 output=FINAL*

[end]
